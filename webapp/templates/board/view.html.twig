{% extends "base.html.twig" %}

{% block title %}Welcome to Labyrinth Online!
{% endblock %}

{% block meta %}
<meta http-equiv="Refresh" content="5">
{% endblock %}

{% block body %}
	{% if canPlay %} 
	<div class="toast show" style="position: absolute; bottom: 40px; right: 40px;">
		<div class="toast-header">
			<strong class="mr-auto">This is Your Turn</strong>
		</div>
		<div class="toast-body">
			You can do the following actions:
			<ul>
				<li>Rotate remaining tile</li>
			{% if boardState.gameState == 0 %}
				<li>Place Tile</li>
			{% elseif boardState.gameState == 0 %}
				<li>Move Pawn</li>
			{% endif %}
			</ul>
		</div>
	</div>
	{% endif %}

	<div class="game">
		<div class="game__actions game__actions--top">
			{% include "board/components/insert_tile.html.twig" with {
				"actionUrl": url("board_insert_tile_top", { "id": board.id }),
				"gameState": boardState.gameState,
				"label": "↓",
			} %}
		</div>

		<div class="game__row">
			<div class="game__actions game__actions--left">
				{% include "board/components/insert_tile.html.twig" with {
					"actionUrl": url("board_insert_tile_left", { "id": board.id }),
					"gameState": boardState.gameState,
					"label": "→",
				} %}
			</div>

			<div class="board">
				{% for line, lineTiles in boardState.tiles %}
					{% for row, boardTile in lineTiles %}
						{% include "board/components/tile.html.twig" with {
							"line": line,
							"row": row,
							"tile": boardTile.tile,
							"rotation": boardTile.rotation,
							"players": boardState.players,
							"gameState": boardState.gameState,
						} %}
					{% endfor %}
				{% endfor %}
			</div>

			<div class="game__actions game__actions--right">
				{% include "board/components/insert_tile.html.twig" with {
					"actionUrl": url("board_insert_tile_right", { "id": board.id }),
					"gameState": boardState.gameState,
					"label": "←",
				} %}
			</div>

			<div class="scores">
				<div class="scores__row scores__row--actions">
					{% include "board/components/rotate_remaining.html.twig" with {
						"actionUrl": url("board_rotate_remaining_anticlockwise", { "id": board.id }),
						"label": "↶",
					} %}

					<div class="tile">
						{% set remainingTile = boardState.remainingTile %}
						{% set tile = remainingTile.tile %}
						<div class="tile__content tile--remaining tile--shape-{{ tile.shape }} tile--rotation-{{ remainingTile.rotation }} {% if target == tile.treasure %}tile--target{% endif %}">
							<div class="emoji">
								{{ emojis[tile.treasure] }}
							</div>
						</div>
					</div>

					{% include "board/components/rotate_remaining.html.twig" with {
						"actionUrl": url("board_rotate_remaining_clockwise", { "id": board.id }),
						"label": "↷",
					} %}
				</div>

				<div class="scores__row">
					<div class="scores__row__label">
						Current Player
					</div>

					<div class="scores__row__value">
						{{ players[currentPlayer.color].name }}
						{% if canPlay %}
							<strong>(Your Turn)</strong>
						{% endif %}
					</div>
				</div>

				<div class="scores__row">
					<div class="scores__row__label">
						Current Color
					</div>

					<div class="scores__row__value">
						{{ colors[currentPlayer.color] }}
					</div>
				</div>

				{% if target != "" %}
				<div class="scores__row">
					<div class="scores__row__label">
						Your Target
					</div>

					<div class="scores__row__value">
						{{ emojis[target] }}
					</div>
				</div>
				{% endif %}

				<div class="scores__row scores__row--heading">
					<div class="scores__row__label">
						Player Scores
					</div>
				</div>

				{% for boardPlayer in boardState.players %}
					<div class="scores__row">
						<div class="scores__row__label">
							{{ players[boardPlayer.color].name }}
						</div>

						<div class="scores__row__value">
							{{ boardPlayer.score  }} / {{ boardPlayer.score + boardPlayer.targets|length }}
						</div>
					</div>
				{% endfor %}
			</div>
		</div>

		<div class="game__actions game__actions--bottom">
			{% include "board/components/insert_tile.html.twig" with {
				"actionUrl": url("board_insert_tile_bottom", { "id": board.id }),
				"gameState": boardState.gameState,
				"label": "↑",
			} %}
		</div>
	</div>
{% endblock %}
